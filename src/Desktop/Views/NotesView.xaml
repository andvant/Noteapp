<UserControl x:Class="Noteapp.Desktop.Views.NotesView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Noteapp.Desktop.Views"
        xmlns:converters="clr-namespace:Noteapp.Desktop.Converters"
        xmlns:vm="clr-namespace:Noteapp.Desktop.ViewModels"
        mc:Ignorable="d">
    <UserControl.Resources>
        <converters:DateTimeToStringConverter x:Key="dateTimeConverter" />
        <converters:BoolToVisibilityConverter x:Key="visibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="45"/>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Center">
            <Button Content="Archived" Command="{Binding ToggleShowArchivedCommand}"/>
            <Button Command="{Binding CreateCommand}" Content="+" Width="90"/>
            <Button Command="{Binding ListCommand}" Content="List" Width="90"/>
        </StackPanel>
        
        <Grid Grid.Row="0" Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="120"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Command="{Binding SaveCommand}" Content="Save" Width="90" />
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                <Menu>
                    <MenuItem Header="Menu">
                        <StackPanel Orientation="Horizontal">
                            <MenuItem Command="{Binding TogglePinnedCommand}" Header="Pin"/>
                            <CheckBox IsChecked="{Binding SelectedNote.Pinned, Mode=OneWay}" IsEnabled="False" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <MenuItem Command="{Binding ToggleLockedCommand}" Header="Lock"/>
                            <CheckBox IsChecked="{Binding SelectedNote.Locked, Mode=OneWay}" IsEnabled="False" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <MenuItem Command="{Binding ToggleArchivedCommand}" Header="Archive"/>
                            <CheckBox IsChecked="{Binding SelectedNote.Archived, Mode=OneWay}" IsEnabled="False" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <MenuItem Command="{Binding TogglePublishedCommand}" Header="Publish"/>
                            <CheckBox IsChecked="{Binding SelectedNote.Published, Mode=OneWay}" IsEnabled="False" />
                        </StackPanel>
                        <MenuItem Command="{Binding ExportCommand}" Header="Export" />
                        <MenuItem Command="{Binding ImportCommand}" Header="Import" />
                        <MenuItem Command="{Binding ShowHistoryCommand}" Header="History" />
                        <MenuItem Command="{Binding DeleteCommand}" Header="Delete"/>
                    </MenuItem>
                </Menu>
            </StackPanel>
        </Grid>

        <StackPanel Grid.Row="1" HorizontalAlignment="Center" Orientation="Horizontal">
            <Label Content="Sort by:" />
            <Button Content="Created" Margin="5" Command="{Binding SortyByCreatedCommand}"/>
            <Button Content="Updated" Margin="5" Command="{Binding SortyByUpdatedCommand}"/>
            <Button Content="Text" Margin="5" Command="{Binding SortyByTextCommand}"/>
        </StackPanel>

        <ListBox Grid.Row="2" Grid.Column="0" ItemsSource="{Binding Notes}" SelectedItem="{Binding SelectedNote}">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Vertical" Height="80">
                        <StackPanel Orientation="Horizontal">
                            <Label Background="#086dd6" Foreground="White" Content="Pinned"
                                   Visibility="{Binding Pinned, Converter={StaticResource visibilityConverter}}"/>
                            <Label Background="#f6a200" Foreground="White" Content="Locked"
                                   Visibility="{Binding Locked, Converter={StaticResource visibilityConverter}}"/>
                            <Label Background="#989898" Foreground="White" Content="Archived"
                                   Visibility="{Binding Archived, Converter={StaticResource visibilityConverter}}"/>
                            <Label Background="#de0231" Foreground="White" Content="Published"
                                   Visibility="{Binding Published, Converter={StaticResource visibilityConverter}}"/>
                        </StackPanel>
                        <TextBlock Text="{Binding TextPreview}" FontSize="14" />
                        <TextBlock Text="{Binding Updated, StringFormat=Updated: {0}, Converter={StaticResource dateTimeConverter}}"
                                   FontSize="14"/>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <Grid Grid.Row="2" Grid.Column="1" >
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!--Selected note text-->
            <TextBox Grid.Row="0" IsReadOnly="{Binding SelectedNote.Locked}" 
                Text="{Binding SelectedNote.Text, UpdateSourceTrigger=PropertyChanged}"
                TextWrapping="Wrap" AcceptsReturn="True" Height="Auto" Width="Auto"
                     HorizontalAlignment="Stretch"/>

            
            <!--Selected note history-->
            <StackPanel Grid.Row="1" Orientation="Vertical" Visibility="{Binding HistoryVisibility}" Margin="10" HorizontalAlignment="Center">
                <Slider Minimum="0" Maximum="{Binding MaximumSnapshotIndex}" 
                    Width="500"
                    TickPlacement="BottomRight" TickFrequency="1" IsSnapToTickEnabled="True" 
                    Value="{Binding CurrentSnapshotIndex}"/>

                <TextBlock Text="{Binding CurrentSnapshotDate, Converter={StaticResource dateTimeConverter}}" HorizontalAlignment="Center"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="Cancel" Command="{Binding CancelHistoryCommand}" />
                    <Button Content="Restore" Command="{Binding RestoreSnapshotCommand}"/>
                </StackPanel>
            </StackPanel>

            

        </Grid>

    </Grid>
</UserControl>
